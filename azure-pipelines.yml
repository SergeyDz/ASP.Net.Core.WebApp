trigger:
- main

pool:
  vmImage: ubuntu-latest

variables:
  GitVersion.SemVer: ''
  buildConfiguration: 'Release'

# resources:
#   containers:
#   - container: pycontainer
#     image: python:3.8
stages: 

  - stage: Setup
    jobs: 
    - job: InstallDotnetCore
      steps:
        - task: UseDotNet@2
          displayName: 'Use .NET Core sdk'
          inputs:
            packageType: sdk
            version: 5.0
            installationPath: $(Agent.ToolsDirectory)/dotnet
    - job: InstallGitVersion
      steps:        
      - task: gitversion/setup@0
        inputs:
          versionSpec: '5.7.0'

  - stage: GitVersion
    jobs: 
    - job: ExtractVersion
      steps:
      - task: gitversion/execute@0
        displayName: gitversion
        inputs:
          updateAssemblyInfo: true
    dependsOn: 
      - Setup

  - stage: Build
    jobs:
      - job: Build
        steps:
        - task: DotNetCoreCLI@2
          inputs:
            command: 'restore'
            feedsToUse: 'select'
            vstsFeed: 'my-vsts-feed' # A series of numbers and letters
          displayName: nuget restore
        
        - task: DotNetCoreCLI@2
          inputs:
            command: 'build'
            arguments: '--configuration $(buildConfiguration)'
          displayName: 'dotnet build $(buildConfiguration)'
    dependsOn: 
      - GitVersion
    
# - script: hostname
#   displayName: 'Run a one-line script'

# # Using the task syntax
# - task: CmdLine@2
#   inputs:
#     script: |
#       echo Add other tasks to build, test, and deploy your project.
#       echo See https://aka.ms/yaml
#   env:
#     AZURE_DEVOPS_EXT_PAT: $(System.AccessToken)
#   displayName: 'Run a multi-line script'

# - task: CmdLine@2
#   inputs: 
#     script: hostname
#   displayName: 'Asking hostname inside container'
#   target: pycontainer